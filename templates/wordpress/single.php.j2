<?php
/**
 * Template: Single {{ module_name }}
 * Généré automatiquement le {{ generated_at }}
 *
 * @package {{ module_name }}
 */

get_header();
?>

<main id="primary" class="site-main {{ slug }}-single">
    <?php while (have_posts()) : the_post(); ?>
        <article id="post-<?php the_ID(); ?>" <?php post_class('{{ slug }}-article'); ?>>

            <header class="entry-header">
                <?php the_title('<h1 class="entry-title">', '</h1>'); ?>

                <div class="entry-meta">
                    <span class="posted-on">
                        <?php echo esc_html(get_the_date()); ?>
                    </span>
                </div>
            </header>

            <?php if (has_post_thumbnail()) : ?>
                <div class="post-thumbnail">
                    <?php the_post_thumbnail('large', array('class' => '{{ slug }}-featured-image')); ?>
                </div>
            <?php endif; ?>

            <div class="entry-content">
                <?php the_content(); ?>
            </div>

            <!-- Champs ACF -->
            <div class="{{ slug }}-fields">
                {% for field in fields %}
                <?php
                ${{ field.name }} = get_field('{{ field.name }}');
                if (${{ field.name }}) :
                ?>
                    <div class="{{ slug }}-field {{ slug }}-field--{{ field.name }}">
                        <strong class="field-label">{{ field.label }} :</strong>
                        {% if field.field_type == 'image' %}
                        <?php if (is_array(${{ field.name }})) : ?>
                            <img src="<?php echo esc_url(${{ field.name }}['url']); ?>"
                                 alt="<?php echo esc_attr(${{ field.name }}['alt']); ?>"
                                 class="{{ slug }}-image">
                        <?php endif; ?>
                        {% elif field.field_type == 'wysiwyg' %}
                        <div class="field-value wysiwyg-content">
                            <?php echo wp_kses_post(${{ field.name }}); ?>
                        </div>
                        {% elif field.field_type == 'date' %}
                        <span class="field-value">
                            <?php echo esc_html(date_i18n(get_option('date_format'), strtotime(${{ field.name }}))); ?>
                        </span>
                        {% elif field.field_type == 'number' %}
                        <span class="field-value">
                            <?php echo esc_html(number_format_i18n(${{ field.name }})); ?>
                        </span>
                        {% else %}
                        <span class="field-value">
                            <?php echo esc_html(${{ field.name }}); ?>
                        </span>
                        {% endif %}
                    </div>
                <?php endif; ?>

                {% endfor %}
            </div>

            <footer class="entry-footer">
                <?php
                edit_post_link(
                    sprintf(
                        wp_kses(
                            __('Modifier <span class="screen-reader-text">%s</span>', '{{ slug }}'),
                            array('span' => array('class' => array()))
                        ),
                        get_the_title()
                    ),
                    '<span class="edit-link">',
                    '</span>'
                );
                ?>
            </footer>

        </article>

        <?php
        // Navigation entre les posts
        the_post_navigation(
            array(
                'prev_text' => '<span class="nav-subtitle">' . esc_html__('Précédent :', '{{ slug }}') . '</span> <span class="nav-title">%title</span>',
                'next_text' => '<span class="nav-subtitle">' . esc_html__('Suivant :', '{{ slug }}') . '</span> <span class="nav-title">%title</span>',
            )
        );

        // Commentaires si activés
        if (comments_open() || get_comments_number()) :
            comments_template();
        endif;
        ?>

    <?php endwhile; ?>
</main>

<?php
get_sidebar();
get_footer();
