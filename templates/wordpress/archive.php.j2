<?php
/**
 * Template: Archive {{ module_name }}
 * Généré automatiquement le {{ generated_at }}
 *
 * @package {{ module_name }}
 */

get_header();
?>

<main id="primary" class="site-main {{ slug }}-archive">

    <header class="page-header">
        <h1 class="page-title">
            <?php
            printf(
                esc_html__('Tous les %ss', '{{ slug }}'),
                '{{ module_name }}'
            );
            ?>
        </h1>
        <?php the_archive_description('<div class="archive-description">', '</div>'); ?>
    </header>

    <?php if (have_posts()) : ?>

        <div class="{{ slug }}-grid">
            <?php while (have_posts()) : the_post(); ?>

                <article id="post-<?php the_ID(); ?>" <?php post_class('{{ slug }}-card'); ?>>

                    <?php if (has_post_thumbnail()) : ?>
                        <div class="card-thumbnail">
                            <a href="<?php the_permalink(); ?>">
                                <?php the_post_thumbnail('medium', array('class' => '{{ slug }}-thumb')); ?>
                            </a>
                        </div>
                    <?php endif; ?>

                    <div class="card-content">
                        <header class="card-header">
                            <?php the_title('<h2 class="card-title"><a href="' . esc_url(get_permalink()) . '">', '</a></h2>'); ?>

                            <div class="card-meta">
                                <span class="posted-on">
                                    <?php echo esc_html(get_the_date()); ?>
                                </span>
                            </div>
                        </header>

                        <div class="card-excerpt">
                            <?php the_excerpt(); ?>
                        </div>

                        <!-- Aperçu des champs ACF -->
                        <div class="card-fields">
                            {% for field in fields[:3] %}
                            <?php
                            ${{ field.name }} = get_field('{{ field.name }}');
                            if (${{ field.name }}) :
                            ?>
                                <div class="card-field card-field--{{ field.name }}">
                                    {% if field.field_type == 'image' %}
                                    <?php if (is_array(${{ field.name }})) : ?>
                                        <img src="<?php echo esc_url(${{ field.name }}['sizes']['thumbnail']); ?>"
                                             alt="<?php echo esc_attr(${{ field.name }}['alt']); ?>"
                                             class="card-image">
                                    <?php endif; ?>
                                    {% elif field.field_type == 'number' %}
                                    <span class="field-label">{{ field.label }}:</span>
                                    <span class="field-value"><?php echo esc_html(number_format_i18n(${{ field.name }})); ?></span>
                                    {% elif field.field_type in ['text', 'date'] %}
                                    <span class="field-label">{{ field.label }}:</span>
                                    <span class="field-value"><?php echo esc_html(${{ field.name }}); ?></span>
                                    {% endif %}
                                </div>
                            <?php endif; ?>
                            {% endfor %}
                        </div>

                        <footer class="card-footer">
                            <a href="<?php the_permalink(); ?>" class="read-more">
                                <?php esc_html_e('Voir plus', '{{ slug }}'); ?>
                                <span class="screen-reader-text"><?php the_title(); ?></span>
                            </a>
                        </footer>
                    </div>

                </article>

            <?php endwhile; ?>
        </div>

        <?php
        // Pagination
        the_posts_pagination(
            array(
                'mid_size'  => 2,
                'prev_text' => sprintf(
                    '<span class="nav-prev-text">%s</span>',
                    esc_html__('Précédent', '{{ slug }}')
                ),
                'next_text' => sprintf(
                    '<span class="nav-next-text">%s</span>',
                    esc_html__('Suivant', '{{ slug }}')
                ),
            )
        );
        ?>

    <?php else : ?>

        <div class="no-results">
            <p><?php esc_html_e('Aucun {{ module_name }} trouvé.', '{{ slug }}'); ?></p>
        </div>

    <?php endif; ?>

</main>

<?php
get_sidebar();
get_footer();
